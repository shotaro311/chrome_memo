# Chrome拡張メモアプリ 要件定義（確定版）

## 1. 概要

### 1.1 目的

ブラウザ右上に表示される軽量なメモパネル（オーバーレイ）で、フォルダ分けされたメモと下書きメモを扱える Chrome 拡張機能を提供する。

### 1.2 コンセプト

- “今見ているページを離れず”にメモする（ページ上のオーバーレイ）
- 新規メモは下書きとして自動保存され、フォルダ保存で通常メモ化
- データは端末ローカルを主（本文）、最小限の同期（設定・構造・メタデータ）

### 1.3 対象ユーザー

- ブラウジング中に断片的なメモを素早く残したいユーザー
- フォルダ単位で簡易に整理したいユーザー

## 2. 対象環境・前提

### 2.1 対象ブラウザ

- Google Chrome（デスクトップ版）

### 2.2 拡張仕様

- Manifest V3

### 2.3 UI言語

- 日本語

### 2.4 権限・対象サイト

- 対象：全サイト（基本方針）
- ただし、Chrome の制約により注入できないページが存在する（例：chrome://、Chrome Web Store 等）。これらは対象外として許容する。

## 3. 主要ユースケース

1) すぐにメモできるシンプルなメモ機能。
2) パネルでフォルダを選び、新規メモ作成・編集・検索
3) ツールバー（拡張アイコン）からフォルダ作成/削除、メモ作成/削除、最近使ったメモを開く

## 4. 画面・UI要件

## 4.1 メモパネル（ページ右上オーバーレイ）

### 4.1.1 表示・位置

- 表示位置：常にページ右上固定
- 被り回避：行わない（被った場合は仕様として許容）
- 1タブあたりのパネル数：常に1つ（既存があれば再利用）

### 4.1.2 開閉と状態保持

- 開く：ショートカット、または拡張アイコン操作（後述）
- 閉じる：パネルの閉じるボタン
- 閉じた後の再表示：最後に開いていたタブ／スプリット状態を復元
- タブ内状態保持：
  - 同一タブ内のリロード/URL遷移でも保持する
  - タブが閉じられるまで保持（ブラウザ再起動・復元後はデフォルトに戻って良い）
  - 閉じる操作は「非表示」にするのみで、同一タブ再表示時はサイズ・タブ一覧・アクティブタブ・スプリット状態を復元する

### 4.1.3 サイズ変更

- ユーザーがドラッグでサイズ変更可能
- 最小サイズ：W 360px / H 260px
- 最大サイズ：W 600px / H 800px

### 4.1.4 フォーカス

- パネル表示時は最後に開いていたタブの本文末尾へフォーカス
- スプリット時は最後に操作していた側を優先する

### 4.1.5 構成

- 上部：ヘッダー（タイトル＋アイコン群）＋タブバー
- 中部：メモ本文エリア（単一表示/左右スプリット）
- 補助：フォルダ/メモ一覧・検索（モーダル表示）

### 4.1.6 タブ/スプリットビュー

- タブは下書きメモ＋通常メモを表示対象とする
- 新規タブボタンで下書きメモを開く（下書きは1件）
- タブは閉じられる（下書きメモ含む）
- タブが多い場合はタブエリアで横スクロール（マウスホイール）
- スプリットビューはアイコンでON/OFF
- ON時は「右側に表示するメモ」をポップアップで選択（開いているタブから選択）
- OFF時は単一表示
- 下書きメモは1件のみ
- 閉じていても内容は保持され、新規タブボタンで再表示できる

### 4.1.7 ショートカット

- パネル開閉のみ
- クイック追記ショートカットは廃止

## 4.2 ツールバー（拡張アイコン）UI

### 4.2.1 役割

- 操作入口（作成/削除/選択/呼び出し）
- 本文編集は必ずパネルで行う

### 4.2.2 表示エリア（最低要件）

- フォルダ選択エリア（選択時：現在アクティブタブのパネルに即反映。閉じていれば開く）
- 最近使ったメモ（最大3件）

### 4.2.3 追加コマンド（確定）

- フォルダ：作成／削除（リネームはパネルのみ）
- メモ：新規作成／削除（タイトル変更はパネルのみ）
- メモ削除：ツールバー内でフォルダ→メモ一覧（タイトルのみ）を表示し、そこから削除可能

### 4.2.4 ツールバーからの作成

- 新規メモ作成の保存先：常に Inbox
- 作成後の挙動：現在アクティブタブのパネルを開き、その新規メモを即編集状態で開く

### 4.2.5 削除確認

- ツールバーからの削除も含め、標準確認（はい/いいえ）のみ

## 5. 機能要件

## 5.1 フォルダ管理

- Inbox：システムフォルダとして常に存在
  - 削除不可・リネーム不可
  - 上限数に含める
- フォルダ作成：ユーザーが作成可能
- フォルダ削除：配下のメモを含めて即時削除（復元不可）
- フォルダ名の重複：禁止
  - 重複判定は「前後空白トリム」＋「大文字小文字を区別しない」
- フォルダ表示順：固定順序を持たない
  - 表示ルール：Inbox を先頭、その後はフォルダ名（ケース無視）昇順

## 5.2 メモ管理（通常メモ）

- メモは「タイトル」「本文（プレーンテキスト）」を持つ
- 新規作成：選択中フォルダに作成（パネル内作成の場合）
  - 初期フォルダ：常に Inbox
- タイトル未入力：可
  - 付与タイミング：作成時点で即時に自動タイトルを付与
  - 自動タイトル例：`New Note (YYYY-MM-DD HH:mm)`
- タイトル重複：同一フォルダ内で禁止
  - 重複判定は「前後空白トリム」＋「大文字小文字を区別しない」
  - 重複時の挙動：保存不可＋エラー表示
- 削除：即時削除（復元不可）＋確認ダイアログ
- 空メモの自動削除：
  - 本文が空のまま、作成後30秒以内にパネルを閉じた場合、自動削除

## 5.3 下書きメモ（新規メモ）

- 下書きは1件のみ
- タブとして表示（閉じる可）
- 自動保存される
- フォルダ保存するまで下書きとして保持
- 下書きメモ → フォルダ保存：
  - 保存先フォルダ選択あり
  - タイトル入力は任意（未入力時は日時ベースで自動タイトル）
  - コピー方式：保存後も下書き本文は残す

### 5.4.1 注入不可ページでの挙動

- パネル表示は不可（許容）
- 追記自体は実行する
- エラー表示：ツールバー（拡張アイコン）Popup 内にエラーメッセージを表示

## 5.5 検索

- 対象：タイトル＋本文
- 一致方式：部分一致（ケース無視）

## 5.6 一覧表示

### 5.6.1 パネル内メモ一覧

- 表示：タイトル＋プレビュー（1行固定、末尾は…）
- 並び順：最終更新日時（updatedAt）降順
- 表示方式：スクロール（ページングなし）

### 5.6.2 ツールバー内メモ一覧

- 表示：タイトルのみ

## 5.7 最近使ったメモ（最大3件）

- “使った”の定義：メモを「開いた時点」でカウント
- 表示件数：最大3件
- クリック時：現在アクティブタブにパネルを表示し、そのメモを開く

## 5.8 自動保存

- 下書きメモは自動保存
- 保存タイミング：入力のdebounce（例：500ms〜1s）

## 5.9 競合

- 同一端末内で同一メモを複数箇所から編集した場合：Last write wins（最後に保存した方が勝つ）

## 6. データ保存・同期

## 6.1 保存方針（ハイブリッド）

- 本文：`chrome.storage.local`（端末ローカル）
- 同期：`chrome.storage.sync`
  - 同期対象は「設定＋構造＋メタデータ」のみ
  - 本文は同期しない

## 6.2 同期するデータ

- 設定（例：ショートカット案内の状態など）
- 構造
  - フォルダ一覧（Inboxを含む）
- メタデータ（最低限）
  - `id, folderId, title, createdAt, updatedAt, lastOpenedAt`

## 6.3 セキュリティ

- 拡張内での暗号化は行わない
- Chrome 標準のストレージ保護に依存

## 7. 上限・制約

- フォルダ数：最大30（Inboxを含む）
- メモ数：1フォルダあたり最大10
- 総メモ数：最大300
- 1メモの最大文字数：20,000文字
- 下書きメモ：TODO（件数）
- 最近使ったメモ表示：最大3件

## 8. 非機能要件

- 安定性：MV3の制約下で、注入不可ページでは適切にフォールバック（エラー表示）
- パフォーマンス：最大件数（300件）における検索・表示が実用的な応答速度であること
- 可観測性：開発時に background / content / popup それぞれでログ確認可能な構成

## 9. 未決事項（現時点での残課題）

- ツールバーPopup内の「エラー表示」文面と表示ルール（例：一定時間で消す/手動で閉じる）
- debounce間隔の最終値
