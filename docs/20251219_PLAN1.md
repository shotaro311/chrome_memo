# プランニングドキュメント：メモのタブ化＋スプリットビュー

**作成日**: 2025-12-19
**バージョン**: 1.0
**ステータス**: 実装中
**前バージョンからの変更**: 新規作成

※初めて作業に取り掛かる場合は、必ずこのプランドキュメントと別にある要件定義書にも目を通してください。

---
# 進捗状況

## ⚡ クイックリファレンス

**現在地**: Phase 4 - スタイル調整（90%） + Phase 4.5 リファクタリング（完了）
**次のアクション**:
- Phase 5 の手動確認（タブ/スプリット/保存/同期）
- ドキュメント最終同期（README / INSTALL）
**ブロッカー**: なし
**重要な決定事項**:
- タブは「新規タブボタン」で追加
- タブが多い場合は横スクロール（タブエリアのマウスホイールで横スクロール）
- スプリットビューは左右2分割
- スプリットビューON時は、ポップアップで開いているタブから右側表示用メモを選択
- クイックメモ概念は廃止
- 新規メモは下書き扱い（フォルダ保存しない限り下書きとして保持）
- 下書きメモは1件のみ（コピー方式）
- パネル再表示時は最後に開いていたタブ/スプリット状態を復元
- ショートカットのクイック追記は削除

### フェーズ進捗
- [x] Phase 0: 既存調査と計画 完了
- [x] Phase 1: UI構造と状態設計 完了
- [x] Phase 2: タブ機能の実装 完了
- [x] Phase 3: スプリットビュー実装 完了
- [🔄] Phase 4: スタイル調整（90%）← **今ここ**
- [x] Phase 4.5: リファクタリング（並行開発 RUN: 20251221-2238）
- [ ] Phase 5: 動作確認とドキュメント同期

### 重要なファイルパス
- メイン: `src/content/content.ts`
- スタイル: `src/styles/panel.css`
- 型定義: `src/types/index.ts`
- 要件定義: `docs/requirement.md`
- 並行開発: `docs/pdev/*`

---

## 🔄 現在の作業状態

**最終更新**: 2025-12-21
**進捗率**: 90%（機能）+ リファクタリング進行中

### 直前の作業
- ✅ 完了: プラン作成と仕様確認（タブ追加/横スクロール/スプリット/下書き化/復元）
- ✅ 完了: 仕様変更（クイックメモ廃止/下書きメモ化/クイック追記ショートカット廃止）
- ✅ 完了: 要件定義書を `docs/requirement.md` にコピー
- ✅ 完了: 下書きメモ仕様確定（1件固定/コピー方式）
- ✅ 完了: タブUI/スプリットUI/モーダルの実装
- ✅ 完了: スプリットモーダルでフォルダ保存メモを選択できるように調整
- ✅ 完了: devビルドのCSP回避（webpack devtoolをsource-mapへ）
- 🔄 作業中: スタイル微調整・動作確認
- ✅ 完了: 並行開発 RUN を作成（`docs/pdev/*`、worktree: pdev-1 / pdev-2）
- ✅ 完了: Content script を分割（`src/content/content.ts` → `src/content/panel*.ts`）+ `npm run build` 通過
- ✅ 完了: Storage 周辺のリファクタ（`src/utils/storage.ts` の重複削減）+ 統合
- ✅ 完了: panel.css のリファクタ（folder-tab / empty-message の重複整理）+ 統合
- ✅ 完了: `npm run build`（統合後に成功）
- ⏳ 次のタスク: 手動確認（タブ/スプリット/保存/同期）→ ドキュメント同期（README/INSTALL）

### ブロッカー・未解決の問題
- なし

---
# 実装内容

## 💭 主要な意思決定
- **タブ追加方式**: 新規タブボタンから作成
- **タブスクロール**: タブエリアの横スクロール（マウスホイール）
- **スプリットビュー**: 左右2分割、右側はポップアップでタブ選択
- **クイックメモ**: 概念を廃止し、新規メモを下書き扱いに変更
- **下書き**: 1件固定、フォルダ保存後も内容は残す（コピー方式）
- **復元**: パネル再表示時は最後に開いていたタブ/スプリット状態を維持
- **ショートカット**: クイック追記は削除

---

## 要件概要

### 目的
- 複数の通常メモを同時に開けるようにし、切替を高速化する。
- 2つのメモを並べて比較・編集できるようにする。

### 対象範囲
- メモパネルUI（タブ、スプリットビュー、選択ポップアップ）
- 既存のメモ作成/保存/開くの流れ
- 新規メモの下書き化（自動保存）

### 非対象（この対応ではやらないこと）
- データ保存方式の変更
- 同期仕様の変更

---

## アーキテクチャ方針（概要）

- タブ状態は「開いているメモIDの配列」と「アクティブタブID」で管理する。
- スプリットビュー時は左右それぞれに表示対象のメモIDを保持する。
- 新規メモ（下書き）は既存のクイックメモ保存ロジックを流用し、1件だけ保持する。
- 既存のメモ読み込み/保存ロジックを再利用し、UI側の表示切り替えを中心に追加する。

---

## 実装フェーズ

### Phase 1: UI構造と状態設計
- パネルHTML構造にタブバーとスプリットビュー用コンテナを追加
- タブ状態・スプリット状態の型/変数を追加
- 既存の単一テキストエリア構造を、左右2ペインに対応できる形へ整理

### Phase 2: タブ機能の実装
- 新規タブボタンの追加（ヘッダーのアイコン群に配置）
- タブクリックでアクティブ切替
- タブクローズで開いているメモを閉じる
- タブエリアの横スクロール対応
- 下書きメモタブの表示（1件）

### Phase 3: スプリットビュー実装
- スプリットビューアイコン追加
- ON/OFF切替の状態管理
- ON時に「右側に開くメモ選択ポップアップ」を表示
- 選択したメモを右ペインに表示

### Phase 4: スタイル調整
- タブバーの見た目、アクティブ/非アクティブ
- 2ペインの境界線、余白、レスポンシブ調整
- 既存ヘッダーとのバランス調整

### Phase 5: 動作確認とドキュメント同期
- 主要フローの手動確認
  - 新規タブ作成、切替、クローズ
  - タブ横スクロール
  - スプリットON/OFF、右側メモ選択
- 要件定義書・README の更新

---

## リスクと対応策

- **状態が複雑化する**: タブ・スプリットの状態を最小限の構造で管理し、UI更新関数を整理する。
- **既存の保存/読み込みと干渉**: 現行の関数を流用し、UI側の表示対象だけを切り替える。

---

## 完了条件

- タブの追加/切替/クローズができる
- 下書きメモがタブとして表示され、保存後も内容が残る
- タブ数が多い場合、タブエリアで横スクロールできる
- スプリットビューで左右に別メモを表示できる
- 仕様変更点が要件定義・READMEに反映されている
