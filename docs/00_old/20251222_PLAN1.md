# プランニングドキュメント：UX改善（ホバーでフォルダ切替 / フォントサイズ選択短縮 / リサイズ支点修正）

**作成日**: 2025-12-22  
**バージョン**: 1.0  
**ステータス**: 実装完了（手動確認待ち）

---

## ⚡ クイックリファレンス

**目的**: 「メモを開く」「フォントサイズ変更」「パネルリサイズ」を少ない操作で快適にする  
**対象**: パネルUI（content script）  
**非対象**: 同期仕様・DBスキーマの変更、データ移行

**完了条件（要点）**
- 📂（ファイルを開く）で、フォルダタブは **ホバーで切替**、メモは **クリックで開く**
- 📂アイコンはホバーでもモーダルが開く
- 🔠（フォントサイズ）は、アイコン押下直後に **サイズが並ぶ**（クリック1回で選択）
- 左下リサイズつまみで、ドラッグ時に **つまみ側が動く**（右側を支点にする）
- 各モーダルは中央寄せではなく上部固定で表示される

---

## 1. 変更したいUX（ユーザー要望）

### 1.1 ファイルモーダル（📂）の操作回数を減らす

現状:
- フォルダ切替がクリック必要 → 目的のフォルダに移るのに手数が増える

変更:
- フォルダタブは **ホバーで切替**（クリック不要）
- メモは **クリックで開く**（誤操作防止のため）

### 1.2 フォントサイズ選択をワンステップ削減

現状:
- 🔠 → メニュー表示 → `<select>` を開く → サイズを選ぶ（2段階）

変更:
- 🔠 を押した直後に、サイズボタン（例: 12/13/…）を表示し、**1クリックで確定**

### 1.3 リサイズつまみの支点を修正

現状:
- パネルをドラッグで動かした後にリサイズすると、**反対側（右側）が動く**ように見える

変更:
- 左下つまみでのリサイズ時は、**右上（右側）を支点**にして、左側（つまみ側）が動くようにする

---

## 2. 現状構成（関係ファイル）

- `src/content/panelActions.ts`：📂モーダル内のフォルダタブ/メモ一覧の描画と操作
- `src/content/panelTemplate.ts`：🔠のUI（ボタン + メニュー）などのHTML
- `src/content/content.ts`：🔠の挙動、リサイズつまみの挙動
- `src/styles/panel.css`：🔠メニュー、📂モーダル、リサイズつまみのスタイル

---

## 3. 実装方針（案）

### 3.1 📂モーダル：フォルダタブのホバーで切替

- `mouseenter` / `pointerenter` でフォルダ切替を実行
- **同じフォルダに対する連続発火を無視**（無駄な再描画を減らす）
- **軽い遅延（例: 100〜200ms）**を入れて、カーソルが通過しただけで切替が連発しないようにする
- メモ一覧は従来通りクリックで開く（ホバーでは開かない）

### 3.2 🔠フォントサイズ：ボタンリスト化

- `<select>` をやめて、サイズ候補を **ボタンのリスト**で表示
- サイズボタン押下で
  - `--memo-font-size` を更新
  - 設定（`memoFontSize`）を保存
  - メニューを閉じる

### 3.3 左下リサイズ：右側支点でサイズ変更

- リサイズ開始時に `getBoundingClientRect()` で `startRight` を保持
- マウス移動時、`newWidth` を計算した後に
  - `left = startRight - newWidth` を設定して **右側の位置を固定**
  - `width/height` と合わせて更新する
- これにより「ドラッグで位置を変えた後（left基準になった後）」でも、つまみ側が動く

---

## 4. タスク分解

### Phase 1: 📂モーダルのホバー切替
- [x] フォルダタブのホバーで `panelState.currentFolderId` を更新
- [x] `renderFileList()` の呼び出しをホバーでも行う（クリックは残す）
- [x] 遅延/連続切替抑制（必要なら）
- [x] 📂アイコンのホバーでモーダルを開く

### Phase 2: 🔠フォントサイズ選択の短縮
- [x] `panelTemplate.ts` のメニューUIをボタンリストに変更
- [x] `content.ts` のイベント処理を変更（ボタンクリックで即反映）
- [x] `panel.css` にボタンリストのスタイル追加

### Phase 3: 左下リサイズつまみの支点修正
- [x] `content.ts` の `setupResize()` を「右側支点」になるよう変更
- [x] 最小/最大サイズの clamp が維持されることを確認
- [x] リサイズ終了時の `panelLastWidth/panelLastHeight` 保存が維持されることを確認

### Phase 4: ドキュメント同期
- [ ] `docs/requirement.md` のUI要件に差分が出る場合は追従
- [ ] `README.md` / `INSTALL.md` に操作方法の差分があれば追従

### Phase 5: モーダル位置の調整
- [x] ファイル/保存/同期/スプリットの各モーダルを上部固定に変更

### Phase 6: ファイルモーダルのホバー離脱で閉じる
- [x] ファイルモーダルからカーソルが離れたら自動で閉じる

### Phase 7: 📂アイコンのホバー遅延
- [x] 📂アイコンのホバー反応に 0.2 秒の遅延を追加

---

## 5. 手動確認チェックリスト（完了判定）

- [ ] 📂を開く → フォルダタブにカーソルを乗せるだけで一覧が切り替わる
- [ ] 📂内のメモは **クリック**したときだけ開く（ホバーでは開かない）
- [ ] 🔠を押す → サイズ候補が即表示され、1クリックで変更できる
- [ ] パネルをドラッグで動かした後でも、左下つまみでのリサイズが「つまみ側が動く」挙動になる
